<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Gold Rush Statistics</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 2px;
            font-size: small;
        }

        th {
            background-color: #f4f4f4;
        }

        input {
            width: 100%;
            padding: 4px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <h1>Gold Rush</h1>
    <p class="rtp">RTP: 0.0</p>
    <hr>
    <div><button id="reset">reset to default values</button></div>
    <hr>
    <div>
        <button style="padding-right: 5px" id="copy">Click to copy to clipboard</button>
        <button id="paste">Click to paste from clipboard</button>
    </div>
    <hr>
    <table>
        <thead>
            <tr>
                <th>Hand</th>
                <th>Payout Ratio</th>
                <th>Count</th>
                <th>Probability (%)</th>
                <th>Payout</th>
                <th>Payout Probability (%)</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
    <p class="rtp">RTP: 0.0</p>
    <hr>
</body>


<script>
    const cache_key = '2025-08-06';  // update to invalidate localstorage
    let hands = [];
    let default_hands = [
        { id: 0, hand: 'A) 123456789 ( alle blitt til gulbarrer)', stat: 1, count: 411536 },
        { id: 1, hand: 'A) 1 100- 119 oppnådd i sum', stat: 1, count: 1403 },
        { id: 2, hand: 'A) 2 eksakt 120 oppnådd i sum', stat: 1, count: 0 },
        { id: 3, hand: 'A) 3 eksakt 49 oppnådd i sum', stat: 1, count: 1353 },
        { id: 4, hand: 'B) 1 linjer under 49', stat: 1, count: 27941215 },
        { id: 5, hand: 'B) 2 linjer under 49', stat: 1, count: 12018339 },
        { id: 6, hand: 'B) 3 linjer under 49', stat: 1, count: 4329236 },
        { id: 7, hand: 'B) 4 linjer under 49', stat: 1, count: 1063880 },
        { id: 8, hand: 'B) 5 linjer under 49', stat: 1, count: 250281 },
        { id: 9, hand: 'B) 6 linjer under 49', stat: 1, count: 102903 },
        { id: 10, hand: 'B) 7 linjer under 49', stat: 1, count: 0 },
        { id: 11, hand: 'B) 8 linjer under 49', stat: 1, count: 4465 },
        { id: 12, hand: 'C) 1 linjer eksakt 49', stat: 1, count: 652667 },
        { id: 13, hand: 'C) 2 linjer eksakt 49', stat: 1, count: 729515 },
        { id: 14, hand: 'C) 3 linjer eksakt 49', stat: 1, count: 437655 },
        { id: 15, hand: 'C) 4 linjer eksakt 49', stat: 1, count: 158018 },
        { id: 16, hand: 'C) 5 linjer eksakt 49', stat: 1, count: 43782 },
        { id: 17, hand: 'C) 6 linjer eksakt 49', stat: 1, count: 22715 },
        { id: 18, hand: 'C) 7 linjer eksakt 49', stat: 1, count: 0 },
        { id: 19, hand: 'C) 8 linjer eksakt 49', stat: 1, count: 1353 },
        { id: 20, hand: 'D) 1 linjer med 50 eller mer', stat: 1, count: 3628695 },
        { id: 21, hand: 'D) 2 linjer med 50 eller mer', stat: 1, count: 6280014 },
        { id: 22, hand: 'D) 3 linjer med 50 eller mer', stat: 1, count: 6680131 },
        { id: 23, hand: 'D) 4 linjer med 50 eller mer', stat: 1, count: 3706577 },
        { id: 24, hand: 'D) 5 linjer med 50 eller mer', stat: 1, count: 1970054 },
        { id: 25, hand: 'D) 6 linjer med 50 eller mer', stat: 1, count: 1559013 },
        { id: 26, hand: 'D) 7 linjer med 50 eller mer', stat: 1, count: 0 },
        { id: 27, hand: 'D) 8 linjer med 50 eller mer', stat: 1, count: 405718 },
        { id: 28, hand: 'E) 0 linjer med 49 eller mer', stat: 1, count: 631563 },
        { id: 29, hand: 'E) 1 linjer med 49 eller mer', stat: 1, count: 4281362 },
        { id: 30, hand: 'E) 2 linjer med 49 eller mer', stat: 1, count: 7009529 },
        { id: 31, hand: 'F) Over 100 uavhengig av antall linjer', stat: 1, count: 1073 },
        { id: 32, hand: 'G) 0 linjer - og eksakt 49', stat: 1, count: 135946 },
    ];

    const total_counts = default_hands.reduce((sum, stat) => sum + stat.count, 0);
    default_hands = default_hands.map((hand) => ({
        ...hand,
        payout: hand.count * hand.stat,
        probability: (hand.count / total_counts).toFixed(8),
        payoutProbability: ((hand.count * hand.stat) / (total_counts * 10000)).toFixed(8)
    })
    )

    function saveLocalStorage() {
        localStorage.setItem(cache_key, JSON.stringify(hands));
    }

    if (localStorage.getItem(cache_key)) {
        hands = JSON.parse(localStorage.getItem(cache_key));
    } else {
        hands = JSON.parse(JSON.stringify(default_hands));
        saveLocalStorage();
    }



    function update_hands() {
        hands = hands.map((hand) => ({
            ...hand,
            payout: hand.count * hand.stat,
            probability: (hand.count / total_counts * 100).toFixed(8),
        }));
        total_payout = hands.reduce((sum, hand) => sum + hand.payout, 0);
        hands = hands.map((hand) => ({
            ...hand,
            payoutProbability: ((hand.payout) / (total_payout) * 100).toFixed(8)
        }));
    }


    function calculate_rtp() {
        const totalPayout = hands.reduce((sum, hand) => sum + (hand.payout), 0);
        return (totalPayout / total_counts).toFixed(8);
    }

    function update_html() {
        const tableBody = document.querySelector('tbody');
        tableBody.innerHTML = ''; // Clear existing rows

        for (hand of hands) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${hand.hand}</td >
                <td>
                    <input type="number" id="${hand.id}" value="${hand.stat}">
                </td>
                <td>${hand.count}</td>
                <td>${hand.probability}</td>
                <td>${hand.payout}</td>
                <td>${hand.payoutProbability}</td>
            `;
            tableBody.appendChild(row);
            const id = hand.id;
            document.getElementById(hand.id).addEventListener('keypress', (event) => {
                const newStat = parseFloat(event.target.value);

                if (isNaN(newStat)) {
                    return
                }
                hands[id].stat = newStat;
                if (event.key === 'Enter' || event.key === 13) {
                    calculate_and_render();
                    document.getElementById(id).focus();
                }
            });
            // "done" on ios
            document.getElementById(hand.id).addEventListener('blur', (event) => {
                calculate_and_render();
            });
        };

        const rtp = calculate_rtp();
        for (const el of document.querySelectorAll('.rtp')) {
            el.innerText = `RTP: ${rtp}`;
        };
    }

    function calculate_and_render() {
        update_hands();
        update_html();
        saveLocalStorage();
    }

    function copy_table() {
        let copy_text = '';
        for (hand of hands) {
            copy_text += `${hand.hand} => ${hand.stat}\n`;
        }
        navigator.clipboard.writeText(copy_text).then(() => {
            alert('Copied to clipboard');
        }).catch(err => {
            console.error('Failed to copy: ', err);
        });
    }

    function paste() {
        navigator.clipboard.readText().then(text => {
            const lines = text.split('\n').filter(line => line.trim() !== '');
            lines.forEach(line => {
                console.log(line);

                const [hand, stat] = line.split('=>').map(part => part.trim());
                const handObj = hands.find(h => h.hand === hand);
                if (handObj) {
                    handObj.stat = parseFloat(stat);
                }
            });
            calculate_and_render();
        }).catch(err => {
            console.error('Failed to read clipboard contents: ', err);
        });
    }

    document.getElementById('paste').addEventListener('click', () => {
        paste();
    });

    document.getElementById('copy').addEventListener('click', () => {
        copy_table();
    });

    document.getElementById('reset').addEventListener('click', () => {
        localStorage.removeItem(cache_key);
        hands = JSON.parse(JSON.stringify(default_hands));
        calculate_and_render();
    });

    calculate_and_render();
</script>

</html>