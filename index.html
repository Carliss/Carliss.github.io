<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Pyramid Statistics</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 2px;
            font-size: small;
        }

        th {
            background-color: #f4f4f4;
        }

        input {
            width: 100%;
            padding: 4px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <h1>Pyramid</h1>
    <h2>Empirical</h2>
    <div>
        <pre>
- empty
A One pair
B Two pair
C Three of a kind
D Straight
E Flush
F Full House
G Four of a kind
H Straight flush
I Royal flush
        </pre>
    </div>
    <p class="rtp">RTP: 0.0</p>

    <table>
        <thead>
            <tr>
                <th>Hand</th>
                <th>Payout Ratio</th>
                <th>Count</th>
                <th>Probability (%)</th>
                <th>Payout</th>
                <th>Payout Probability (%)</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
    <p class="rtp">RTP: 0.0</p>
    <hr>
    <div>
        <button id="update" style="
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        ">Click to Update, or enter/return to update</button>
    </div>
    <hr>
    <div>
        <button id="copy" style="
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        ">Click to copy to clipboard</button>
    </div>
</body>


<script>
    let hands = [
        { id: 0, hand: '-', stat: 0, count: 17787555 },
        { id: 1, hand: 'A', stat: 0, count: 43849200 },
        { id: 2, hand: 'AB', stat: 0.5, count: 23490874 },
        { id: 3, hand: 'ABCF', stat: 7, count: 2593886 },
        { id: 4, hand: 'ABCFG', stat: 100, count: 31275 },
        { id: 5, hand: 'ABD', stat: 12, count: 169097 },
        { id: 6, hand: 'ABDH', stat: 100, count: 2443 },
        { id: 7, hand: 'ABDI', stat: 3000, count: 270 },
        { id: 8, hand: 'ABE', stat: 12, count: 343320 },
        { id: 9, hand: 'AC', stat: 4, count: 4831793 },
        { id: 10, hand: 'ACD', stat: 12, count: 37368 },
        { id: 11, hand: 'ACDH', stat: 250, count: 396 },
        { id: 12, hand: 'ACDI', stat: 3000, count: 44 },
        { id: 13, hand: 'ACE', stat: 12, count: 57039 },
        { id: 14, hand: 'ACG', stat: 12, count: 137406 },
        { id: 15, hand: 'AD', stat: 6, count: 1864766 },
        { id: 16, hand: 'ADE', stat: 25, count: 49137 },
        { id: 17, hand: 'ADEH', stat: 100, count: 2866 },
        { id: 18, hand: 'ADEHI', stat: 3000, count: 63 },
        { id: 19, hand: 'ADEI', stat: 1, count: 279 },
        { id: 20, hand: 'ADH', stat: 25, count: 9788 },
        { id: 21, hand: 'ADI', stat: 3000, count: 962 },
        { id: 22, hand: 'AE', stat: 6, count: 1505974 },
        { id: 23, hand: 'AEH', stat: 25, count: 488 },
        { id: 24, hand: 'AEI', stat: 250, count: 105 },
        { id: 25, hand: 'AH', stat: 25, count: 479 },
        { id: 26, hand: 'AI', stat: 250, count: 200 },
        { id: 27, hand: 'D', stat: 6, count: 2150363 },
        { id: 28, hand: 'DE', stat: 12, count: 105257 },
        { id: 29, hand: 'DEH', stat: 1, count: 1081 },
        { id: 30, hand: 'DEHI', stat: 50000, count: 7 },
        { id: 31, hand: 'DEI', stat: 50000, count: 56 },
        { id: 32, hand: 'DH', stat: 25, count: 2952 },
        { id: 33, hand: 'DI', stat: 3000, count: 184 },
        { id: 34, hand: 'E', stat: 6, count: 965990 },
        { id: 35, hand: 'EH', stat: 25, count: 3374 },
        { id: 36, hand: 'EHI', stat: 3000, count: 80 },
        { id: 37, hand: 'EI', stat: 250, count: 491 },
        { id: 38, hand: 'H', stat: 25, count: 3844 },
        { id: 39, hand: 'I', stat: 250, count: 608 },
    ];
    const total_counts = hands.reduce((sum, stat) => sum + stat.count, 0);
    hands = hands.map((hand) => ({
        ...hand,
        payout: hand.count * hand.stat,
        probability: (hand.count / total_counts).toFixed(8),
        payoutProbability: ((hand.count * hand.stat) / (total_counts * 10000)).toFixed(8)
    })
    )

    function update_hands() {
        hands = hands.map((hand) => ({
            ...hand,
            payout: hand.count * hand.stat,
            probability: (hand.count / total_counts * 100).toFixed(8),
        }));
        total_payout = hands.reduce((sum, hand) => sum + hand.payout, 0);
        hands = hands.map((hand) => ({
            ...hand,
            payoutProbability: ((hand.payout) / (total_payout) * 100).toFixed(8)
        }));
    }


    function calculate_rtp() {
        const totalPayout = hands.reduce((sum, hand) => sum + (hand.payout), 0);
        return (totalPayout / total_counts).toFixed(8);
    }

    function update_html() {
        const tableBody = document.querySelector('tbody');
        tableBody.innerHTML = ''; // Clear existing rows

        for (hand of hands) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${hand.hand}</td >
                <td>
                    <input type="number" id="${hand.id}" value="${hand.stat}">
                </td>
                <td>${hand.count}</td>
                <td>${hand.probability}</td>
                <td>${hand.payout}</td>
                <td>${hand.payoutProbability}</td>
            `;
            tableBody.appendChild(row);
            const id = hand.id;
            document.getElementById(hand.id).addEventListener('keypress', (event) => {
                const newStat = parseFloat(event.target.value);

                if (isNaN(newStat)) {
                    return
                }
                hands[id].stat = newStat;
                if (event.key === 'Enter' || event.key === 13) {
                    calculate_and_render();
                    document.getElementById(id).focus();
                }
            });
            // "done" on ios
            document.getElementById(hand.id).addEventListener('blur', (event) => {
                calculate_and_render();
            });
        };

        const rtp = calculate_rtp();
        for (const el of document.querySelectorAll('.rtp')) {
            el.innerText = `RTP: ${rtp}`;
        };
    }

    function calculate_and_render() {
        update_hands();
        update_html();
    }

    document.getElementById('update').addEventListener('click', () => {
        calculate_and_render();
    });

    function copy_table() {
        let copy_text = '';
        for (hand of hands) {
            copy_text += `${hand.hand} => ${hand.stat}\n`;
        }
        navigator.clipboard.writeText(copy_text).then(() => {
            alert('Copied to clipboard');
        }).catch(err => {
            console.error('Failed to copy: ', err);
        });
    }

    document.getElementById('copy').addEventListener('click', () => {
        copy_table();
    });

    calculate_and_render();
</script>

</html>