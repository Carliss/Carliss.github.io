<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Gold Rush Statistics</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 2px;
            font-size: small;
        }

        th {
            background-color: #f4f4f4;
        }

        input {
            width: 100%;
            padding: 4px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <h1>Gold Rush</h1>
    <p class="rtp">RTP: 0.0</p>
    <hr>
    <div><button id="reset">reset to default values</button></div>
    <hr>
    <div>
        <button style="padding-right: 5px" id="copy">Click to copy to clipboard</button>
        <button id="paste">Click to paste from clipboard</button>
    </div>
    <hr>
    <table>
        <thead>
            <tr>
                <th id="th-id">Hand</th>
                <th id="th-sats">Payout Ratio</th>
                <th id="th-count">Count</th>
                <th id="th-probability">Probability (%)</th>
                <th id="th-payout">Payout</th>
                <th id="th-payoutProbability">Payout Probability (%)</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
    <p class="rtp">RTP: 0.0</p>
    <hr>
</body>


<script>

    const cache_key = '2025-08-10';  // update to invalidate localstorage
    let hands = [];
    let default_hands = [
        { id: 0, hand: "A0) 0 lines - sum is less than 49", sats: 0, count: 2854505 },
        { id: 1, hand: "A1) 1 lines - sum is less than 49", sats: 0, count: 2798145 },
        { id: 2, hand: "A2) 2 lines - sum is less than 49", sats: 0.5, count: 1174930 },
        { id: 3, hand: "A3) 3 lines - sum is less than 49", sats: 1, count: 408230 },
        { id: 4, hand: "A4) 4 lines - sum is less than 49", sats: 2, count: 99079 },
        { id: 5, hand: "A5) 5 lines - sum is less than 49", sats: 5, count: 20360 },
        { id: 6, hand: "A6) 6 lines - sum is less than 49", sats: 10, count: 8230 },
        { id: 7, hand: "A7) 7 lines - sum is less than 49", sats: 0, count: 0 },
        { id: 8, hand: "A8) 8 lines - sum is less than 49", sats: 100, count: 332 },
        { id: 9, hand: "B0) 0 lines - sum is 49", sats: 1, count: 17653 },
        { id: 10, hand: "B1) 1 lines - sum is 49", sats: 2, count: 71308 },
        { id: 11, hand: "B2) 2 lines - sum is 49", sats: 4, count: 71394 },
        { id: 12, hand: "B3) 3 lines - sum is 49", sats: 8, count: 41576 },
        { id: 13, hand: "B4) 4 lines - sum is 49", sats: 16, count: 14924 },
        { id: 14, hand: "B5) 5 lines - sum is 49", sats: 32, count: 3534 },
        { id: 15, hand: "B6) 6 lines - sum is 49", sats: 64, count: 1862 },
        { id: 16, hand: "B7) 7 lines - sum is 49", sats: 0, count: 0 },
        { id: 17, hand: "B8) 8 lines - sum is 49", sats: 100, count: 102 },
        { id: 18, hand: "C0) 0 lines - sum is 50 or more", sats: 0, count: 65164 },
        { id: 19, hand: "C1) 1 lines - sum is 50 or more", sats: 0, count: 412209 },
        { id: 20, hand: "C2) 2 lines - sum is 50 or more", sats: 0.5, count: 620776 },
        { id: 21, hand: "C3) 3 lines - sum is 50 or more", sats: 1, count: 645771 },
        { id: 22, hand: "C4) 4 lines - sum is 50 or more", sats: 2, count: 346784 },
        { id: 23, hand: "C5) 5 lines - sum is 50 or more", sats: 5, count: 164328 },
        { id: 24, hand: "C6) 6 lines - sum is 50 or more", sats: 10, count: 129355 },
        { id: 25, hand: "C7) 7 lines - sum is 50 or more", sats: 0, count: 0 },
        { id: 26, hand: "C8) 8 lines - sum is 50 or more", sats: 100, count: 29449 },
    ];

    const total_counts = default_hands.reduce((sum, sats) => sum + sats.count, 0);
    default_hands = default_hands.map((hand) => ({
        ...hand,
        payout: hand.count * hand.sats,
        probability: (hand.count / total_counts).toFixed(8),
        payoutProbability: ((hand.count * hand.sats) / (total_counts * 10000)).toFixed(8)
    })
    )

    function saveLocalStorage() {
        localStorage.setItem(cache_key, JSON.stringify(hands));
    }

    if (localStorage.getItem(cache_key)) {
        hands = JSON.parse(localStorage.getItem(cache_key));
    } else {
        hands = JSON.parse(JSON.stringify(default_hands));
        saveLocalStorage();
    }



    function update_hands() {
        hands = hands.map((hand) => ({
            ...hand,
            payout: hand.count * hand.sats,
            probability: (hand.count / total_counts * 100).toFixed(8),
        }));
        total_payout = hands.reduce((sum, hand) => sum + hand.payout, 0);
        hands = hands.map((hand) => ({
            ...hand,
            payoutProbability: ((hand.payout) / (total_payout) * 100).toFixed(8)
        }));
    }


    function calculate_rtp() {
        const totalPayout = hands.reduce((sum, hand) => sum + (hand.payout), 0);
        return (totalPayout / total_counts).toFixed(8);
    }

    // for table sorting
    const ths_object = {
        'th-id': 1, // default to ascending order for 'Hand'
        'th-sats': 0,
        'th-count': 0,
        'th-probability': 0,
        'th-payout': 0,
        'th-payoutProbability': 0,
    };
    const ths = Object.keys(ths_object);

    for (let th of ths) {
        document.getElementById(th).addEventListener('click', () => {
            console.log(`Column ${th} clicked. Current sort order: ${ths_object[th]}`);

            ths.forEach((t) => {
                if (t !== th) {
                    ths_object[t] = 0; // reset other ths
                }
            });
            if (ths_object[th] !== 1) {
                ths_object[th] = 1; // ascending
                console.log(`Column ${th} set to ascending order.`);
            } else {
                ths_object[th] = -1; // descending
                console.log(`Column ${th} set to descending order.`);
            }
            calculate_and_render();
        });
    }

    function sort_rows(rows) {
        // get current ths
        const current_th = ths.find(th => ths_object[th] !== 0);
        if (!current_th) {
            return rows; // No sorting applied
        }
        const sortOrder = ths_object[current_th];
        if (sortOrder === 0) {
            return rows; // No sorting applied
        }
        return rows.sort((a, b) => {
            const aValue = parseFloat(a[current_th.replace('th-', '')]);
            const bValue = parseFloat(b[current_th.replace('th-', '')]);
            return sortOrder * (aValue - bValue);
        });
    }

    function update_html() {
        const tableBody = document.querySelector('tbody');
        tableBody.innerHTML = ''; // Clear existing rows

        for (hand of sort_rows(hands)) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${hand.hand}</td >
                <td>
                    <input type="number" id="${hand.id}" value="${hand.sats}">
                </td>
                <td>${hand.count}</td>
                <td>${hand.probability}</td>
                <td>${hand.payout}</td>
                <td>${hand.payoutProbability}</td>
            `;
            tableBody.appendChild(row);
            const id = hand.id;
            document.getElementById(hand.id).addEventListener('keypress', (event) => {
                const newSats = parseFloat(event.target.value);

                if (isNaN(newSats)) {
                    return
                }
                hands.filter(h => h.id === id)[0].sats = newSats;
                if (event.key === 'Enter' || event.key === 13) {
                    calculate_and_render();
                    document.getElementById(id).focus();
                }
            });
            // "done" on ios
            document.getElementById(hand.id).addEventListener('blur', (event) => {
                calculate_and_render();
            });
        };

        const rtp = calculate_rtp();
        for (const el of document.querySelectorAll('.rtp')) {
            el.innerText = `RTP: ${rtp}`;
        };
    }

    function calculate_and_render() {
        update_hands();
        update_html();
        saveLocalStorage();
    }

    function copy_table() {
        let copy_text = '';
        for (hand of hands) {
            copy_text += `${hand.hand} => ${hand.sats}\n`;
        }
        navigator.clipboard.writeText(copy_text).then(() => {
            alert('Copied to clipboard');
        }).catch(err => {
            console.error('Failed to copy: ', err);
        });
    }

    function paste() {
        navigator.clipboard.readText().then(text => {
            const lines = text.split('\n').filter(line => line.trim() !== '');
            lines.forEach(line => {
                console.log(line);

                const [hand, sats] = line.split('=>').map(part => part.trim());
                const handObj = hands.find(h => h.hand === hand);
                if (handObj) {
                    handObj.sats = parseFloat(sats);
                }
            });
            calculate_and_render();
        }).catch(err => {
            console.error('Failed to read clipboard contents: ', err);
        });
    }

    document.getElementById('paste').addEventListener('click', () => {
        paste();
    });

    document.getElementById('copy').addEventListener('click', () => {
        copy_table();
    });

    document.getElementById('reset').addEventListener('click', () => {
        localStorage.removeItem(cache_key);
        hands = JSON.parse(JSON.stringify(default_hands));
        calculate_and_render();
    });

    calculate_and_render();
</script>

</html>